<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>POULTRY ‚Ä¢ REWARDS ADMIN (ZAR)</title>
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      background-color: #0a0a0a;
      color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    #app {
      width: 100%;
      max-width: 420px;
      height: 780px;
      background: #0f0f0f;
      border-radius: 32px;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8), 0 0 0 1px rgba(212,175,55,0.2);
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .glass {
      background: rgba(30,30,30,0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(212,175,55,0.15);
      border-bottom: 1px solid rgba(212,175,55,0.3);
      box-shadow: 0 8px 20px -6px rgba(0,0,0,0.6);
    }
    .header {
      padding: 18px 20px 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: transparent;
    }
    .header h1 {
      font-size: 1.6rem;
      font-weight: 500;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #fff 0%, #d4af37 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .header i {
      font-size: 1.5rem;
      color: #d4af37;
      background: rgba(212,175,55,0.1);
      padding: 10px;
      border-radius: 50%;
    }
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px 16px 80px 16px;
      scrollbar-width: thin;
      scrollbar-color: #d4af37 #1e1e1e;
    }
    .main-content::-webkit-scrollbar {
      width: 4px;
    }
    .main-content::-webkit-scrollbar-track {
      background: #1e1e1e;
    }
    .main-content::-webkit-scrollbar-thumb {
      background: #d4af37;
      border-radius: 8px;
    }
    .bottom-nav {
      position: absolute;
      bottom: 0;
      width: 100%;
      max-width: 420px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: rgba(10,10,10,0.9);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-top: 1px solid rgba(212,175,55,0.3);
      padding: 4px 0 10px 0;
      z-index: 10;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #888;
      font-size: 0.6rem;
      transition: all 0.15s ease;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 30px;
      background: transparent;
    }
    .nav-item i {
      font-size: 1.2rem;
      margin-bottom: 2px;
    }
    .nav-item.active {
      color: #d4af37;
      background: rgba(212,175,55,0.1);
      text-shadow: 0 0 8px #d4af3740;
    }
    .card {
      background: rgba(20,20,20,0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 24px;
      padding: 18px 16px;
      margin-bottom: 16px;
      box-shadow: 0 10px 20px -10px black;
    }
    .card-title {
      font-size: 1rem;
      font-weight: 500;
      color: #d4af37;
      margin-bottom: 14px;
      letter-spacing: 0.3px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .stat {
      background: rgba(0,0,0,0.4);
      border-radius: 18px;
      padding: 14px 12px;
      border-left: 3px solid #d4af37;
    }
    .stat-label {
      font-size: 0.7rem;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }
    .stat-value {
      font-size: 1.4rem;
      font-weight: 600;
      color: white;
      line-height: 1.2;
    }
    .stat-sub {
      font-size: 0.75rem;
      color: #6b8e4c;
    }
    .badge {
      background: #6b8e4c20;
      border: 1px solid #6b8e4c;
      color: #b7d99e;
      padding: 4px 8px;
      border-radius: 40px;
      font-size: 0.7rem;
    }
    .reward-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #2a2a2a;
    }
    .reward-info h4 { font-size: 1rem; font-weight: 500; }
    .reward-info p { font-size: 0.7rem; color: #aaa; }
    .reward-badge {
      background: #d4af3720;
      border: 1px solid #d4af37;
      border-radius: 40px;
      padding: 4px 10px;
      font-size: 0.7rem;
    }
    .btn-gold {
      background: #d4af3720;
      border: 1px solid #d4af37;
      color: #d4af37;
      border-radius: 40px;
      padding: 10px 18px;
      font-weight: 500;
      font-size: 0.9rem;
      width: fit-content;
      backdrop-filter: blur(4px);
      transition: 0.2s;
      cursor: pointer;
    }
    .btn-gold:active { background: #d4af3740; }
    .btn-small {
      background: transparent;
      border: 1px solid #d4af37;
      color: #d4af37;
      border-radius: 30px;
      padding: 6px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      margin-right: 6px;
    }
    .btn-small.active { background: #d4af37; color: #0a0a0a; }
    .flex-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .gold-text { color: #d4af37; }
    .green-text { color: #6b8e4c; }
    hr { border: 0.5px solid #2a2a2a; margin: 12px 0; }
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }
    /* reward card swipe simulation (horizontal scroll) */
    .swipe-cards {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 4px 0 12px;
      scroll-snap-type: x mandatory;
    }
    .swipe-cards::-webkit-scrollbar { display: none; }
    .reward-swipe-card {
      min-width: 240px;
      background: #1e1e1e;
      border-radius: 24px;
      padding: 16px;
      border: 1px solid #d4af3740;
      scroll-snap-align: start;
    }
    .cost-input {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }
    .cost-input label { color: #ccc; font-size: 0.9rem; }
    .cost-input input {
      width: 100px;
      background: #2a2a2a;
      border: 1px solid #d4af3740;
      border-radius: 30px;
      padding: 8px 12px;
      color: #fff;
      text-align: right;
    }
    .cost-input input:focus { outline: none; border-color: #d4af37; }
    .helper-text { font-size: 0.7rem; color: #aaa; }
  </style>
</head>
<body>
<div id="app">
  <div class="header">
    <h1>üêî POULTRY ¬∑ REWARDS</h1>
    <i class="fas fa-gift"></i>
  </div>

  <div class="main-content" id="mainContent">
    <!-- DASHBOARD PANE (existing + new KPI) -->
    <div class="tab-pane active" id="dashboardPane">
      <!-- original KPI + REWARDS KPI card -->
      <div class="card">
        <div class="card-title"><i class="fas fa-gauge-high gold-text"></i> key performance indicators</div>
        <div class="grid-2">
          <div class="stat"><span class="stat-label">active birds</span><div class="stat-value" id="kpiActiveBirds">2,322</div></div>
          <div class="stat"><span class="stat-label">mortality %</span><div class="stat-value" id="kpiMortality">0.9%</div></div>
          <div class="stat"><span class="stat-label">avg price</span><div class="stat-value" id="kpiAvgPrice">R 84.50</div></div>
          <div class="stat"><span class="stat-label">cost / bird</span><div class="stat-value" id="kpiCostPerBird">R 62.00</div></div>
        </div>
      </div>
      <!-- new rewards KPI card -->
      <div class="card">
        <div class="card-title"><i class="fas fa-star gold-text"></i> rewards KPI (this month)</div>
        <div class="grid-2">
          <div class="stat"><span class="stat-label">claimed</span><div class="stat-value" id="rewardsClaimed">24</div></div>
          <div class="stat"><span class="stat-label">active</span><div class="stat-value" id="rewardsActive">42</div></div>
          <div class="stat"><span class="stat-label">upcoming</span><div class="stat-value" id="rewardsUpcoming">13</div></div>
          <div class="stat"><span class="stat-label">by‚Äëproduct uptake</span><div class="stat-value" id="byproductUptake">18</div></div>
          <div class="stat"><span class="stat-label">referral credits</span><div class="stat-value" id="referralCredits">R 1,240</div></div>
          <div class="stat"><span class="stat-label">projected discount</span><div class="stat-value" id="projectedDiscount">R 2,150</div></div>
        </div>
      </div>

      <!-- profit overview with reward impact -->
      <div class="card">
        <div class="card-title"><i class="fas fa-coins gold-text"></i> profit & reward impact</div>
        <div class="cost-item"><span>üìà base net profit</span> <span class="gold-text" id="baseNetProfit">R 86,400</span></div>
        <div class="cost-item"><span>üîª active discounts</span> <span id="totalDiscounts">- R 2,150</span></div>
        <div class="cost-item"><span>‚ûï referral credits</span> <span id="totalReferrals">+ R 1,240</span></div>
        <div class="cost-item"><span>üåü by‚Äëproduct bonus</span> <span id="totalByproductBonus">+ R 540</span></div>
        <div class="cost-item" style="border-top:1px solid #333;"><span>üìä adjusted net profit</span> <strong class="green-text" id="adjustedNetProfit">R 86,030</strong></div>
        <div class="flex-row" style="margin-top:8px;"><span class="badge">next forecast includes reward discounts</span></div>
      </div>

      <!-- existing weekly trend (shortened) -->
      <div class="card">
        <div class="card-title"><i class="fas fa-chart-line gold-text"></i> weekly trend</div>
        <div style="display: flex; gap:8px; justify-content:space-between;"><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span><span>S</span></div>
        <div style="display: flex; gap:8px; margin-top:6px;">
          <div style="height:40px; width:12%; background:#d4af37; border-radius:12px;"></div>
          <div style="height:30px; width:12%; background:#d4af37; border-radius:12px;"></div>
          <div style="height:50px; width:12%; background:#d4af37; border-radius:12px;"></div>
          <div style="height:36px; width:12%; background:#d4af37; border-radius:12px;"></div>
          <div style="height:60px; width:12%; background:#d4af37; border-radius:12px;"></div>
          <div style="height:44px; width:12%; background:#d4af37; border-radius:12px;"></div>
          <div style="height:38px; width:12%; background:#aaa; border-radius:12px;"></div>
        </div>
      </div>
    </div>

    <!-- INVENTORY, SALES, LOGISTICS, BUDGET, SETTINGS panes (shortened for space, but functional) -->
    <!-- we include minimal representation but keep DOM structure for navigation -->
    <div class="tab-pane" id="inventoryPane"><div class="card"><div class="card-title">inventory (original)</div><p>batch data kept</p></div></div>
    <div class="tab-pane" id="salesPane"><div class="card"><div class="card-title">sales (original)</div><p>product mix & revenue</p></div></div>
    <div class="tab-pane" id="logisticsPane"><div class="card"><div class="card-title">logistics</div><p>delivery & feed</p></div></div>
    <div class="tab-pane" id="budgetPane"><div class="card"><div class="card-title">budget / P&L</div><p>cost tracker</p></div></div>
    <div class="tab-pane" id="settingsPane"><div class="card"><div class="card-title">settings</div><p>triggers & profile</p></div></div>

    <!-- NEW REWARDS MANAGEMENT PANE -->
    <div class="tab-pane" id="rewardsPane">
      <!-- admin controls card -->
      <div class="card">
        <div class="card-title"><i class="fas fa-sliders-h gold-text"></i> reward rules (admin)</div>
        <div class="cost-input"><label>‚úÖ enable rewards</label> <input type="checkbox" id="rewardsEnabled" checked style="width:20px;"></div>
        <div class="cost-input"><label>üêî chickens per reward</label> <input type="number" id="chickensPerReward" value="10" min="1" step="1"></div>
        <div class="cost-input"><label>üìÜ streak days</label> <input type="number" id="streakDays" value="5" min="1"></div>
        <div class="cost-input"><label>üî¢ tier levels</label> <input type="number" id="tierLevels" value="3" min="1"></div>
        <div class="cost-input"><label>üí∞ discount %</label> <input type="number" id="discountPercent" value="8" min="0" max="30" step="0.5"></div>
        <div class="cost-input"><label>üåü double by‚Äëproduct day</label> <input type="checkbox" id="doubleByproduct" checked></div>
        <div class="flex-row"><button class="btn-small" id="syncRulesBtn">sync to projection</button><span class="helper-text">edits auto‚Äëapply</span></div>
      </div>

      <!-- swipeable card view (rewards list) + table style -->
      <div class="card">
        <div class="card-title"><i class="fas fa-id-card gold-text"></i> swipe view ¬∑ active rewards</div>
        <div class="swipe-cards" id="swipeRewardsContainer">
          <!-- dynamically filled via JS -->
        </div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-table gold-text"></i> all customer rewards</div>
        <div style="overflow-x: auto;">
          <table style="width:100%; border-collapse:collapse; font-size:0.7rem;">
            <thead><tr style="color:#d4af37;"><th>ID</th><th>Name</th><th>Type</th><th>Progress</th><th>Status</th><th>Expiry</th><th>Disc</th><th>ByP</th><th>Ref</th></tr></thead>
            <tbody id="rewardsTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- simulation purchase button (real‚Äëtime sync demo) -->
      <div class="card">
        <div class="card-title"><i class="fas fa-sync-alt gold-text"></i> real‚Äëtime sync</div>
        <p>click to simulate a customer purchase ‚Üí updates progress, KPIs, forecast</p>
        <button class="btn-gold" id="simulatePurchaseBtn"><i class="fas fa-cart-plus"></i> simulate purchase</button>
        <div class="flex-row" style="margin-top:12px;"><span class="badge" id="lastSyncMsg">last sync: just now</span></div>
      </div>

      <!-- optional notifications -->
      <div class="card" id="notificationCard" style="border-color:#b77b3a;">
        <div class="card-title"><i class="fas fa-bell gold-text"></i> alerts</div>
        <div id="alertMessages">‚ú® 2 rewards expiring soon ¬∑ top achiever: John D (12 birds)</div>
      </div>
    </div>
  </div>

  <!-- bottom navigation with 7 items (rewards added) -->
  <div class="bottom-nav">
    <div class="nav-item active" data-tab="dashboard"><i class="fas fa-chart-pie"></i><span>Home</span></div>
    <div class="nav-item" data-tab="inventory"><i class="fas fa-egg"></i><span>Stock</span></div>
    <div class="nav-item" data-tab="sales"><i class="fas fa-cash-register"></i><span>Sales</span></div>
    <div class="nav-item" data-tab="logistics"><i class="fas fa-truck"></i><span>Logistics</span></div>
    <div class="nav-item" data-tab="budget"><i class="fas fa-chart-line"></i><span>Budget</span></div>
    <div class="nav-item" data-tab="settings"><i class="fas fa-gear"></i><span>Settings</span></div>
    <div class="nav-item" data-tab="rewards"><i class="fas fa-gift"></i><span>Rewards</span></div>
  </div>
</div>

<script>
  (function() {
    // ----- TAB NAVIGATION -----
    const navItems = document.querySelectorAll('.nav-item');
    const panes = {
      dashboard: document.getElementById('dashboardPane'),
      inventory: document.getElementById('inventoryPane'),
      sales: document.getElementById('salesPane'),
      logistics: document.getElementById('logisticsPane'),
      budget: document.getElementById('budgetPane'),
      settings: document.getElementById('settingsPane'),
      rewards: document.getElementById('rewardsPane')
    };
    function setActiveTab(tabId) {
      navItems.forEach(item => item.classList.remove('active'));
      Object.values(panes).forEach(pane => pane?.classList.remove('active'));
      const activeNav = Array.from(navItems).find(item => item.dataset.tab === tabId);
      if (activeNav) activeNav.classList.add('active');
      if (panes[tabId]) panes[tabId].classList.add('active');
    }
    navItems.forEach(item => {
      item.addEventListener('click', () => setActiveTab(item.dataset.tab));
    });

    // ----- REWARDS MOCK DATA & INTEGRATION -----
    const customers = [
      { id: 'C001', name: 'John D', type: 'referral', progress: 8, total: 10, status: 'active', expiry: '2025-04-15', discount: 8, byproduct: false, referralCredit: 120 },
      { id: 'C002', name: 'Mary K', type: 'streak', progress: 5, total: 5, status: 'claimed', expiry: '2025-03-30', discount: 8, byproduct: true, referralCredit: 0 },
      { id: 'C003', name: 'Peter S', type: 'tier', progress: 3, total: 5, status: 'upcoming', expiry: '2025-05-01', discount: 5, byproduct: false, referralCredit: 0 },
      { id: 'C004', name: 'Lerato M', type: 'referral', progress: 10, total: 10, status: 'active', expiry: '2025-04-10', discount: 10, byproduct: true, referralCredit: 200 },
      { id: 'C005', name: 'Thabo W', type: 'byproduct', progress: 4, total: 8, status: 'active', expiry: '2025-04-20', discount: 0, byproduct: true, referralCredit: 0 },
    ];

    // admin settings
    let rewardsEnabled = true;
    let chickensPerReward = 10;
    let discountPercent = 8;
    let doubleByproduct = true;

    // DOM references
    const swipeContainer = document.getElementById('swipeRewardsContainer');
    const tableBody = document.getElementById('rewardsTableBody');
    const rewardsClaimedSpan = document.getElementById('rewardsClaimed');
    const rewardsActiveSpan = document.getElementById('rewardsActive');
    const rewardsUpcomingSpan = document.getElementById('rewardsUpcoming');
    const byproductUptakeSpan = document.getElementById('byproductUptake');
    const referralCreditsSpan = document.getElementById('referralCredits');
    const projectedDiscountSpan = document.getElementById('projectedDiscount');
    const baseNetProfitSpan = document.getElementById('baseNetProfit');
    const totalDiscountsSpan = document.getElementById('totalDiscounts');
    const totalReferralsSpan = document.getElementById('totalReferrals');
    const totalByproductBonusSpan = document.getElementById('totalByproductBonus');
    const adjustedNetProfitSpan = document.getElementById('adjustedNetProfit');

    // Inputs
    const rewardsEnabledCheck = document.getElementById('rewardsEnabled');
    const chickensPerRewardInput = document.getElementById('chickensPerReward');
    const discountPercentInput = document.getElementById('discountPercent');
    const doubleByproductCheck = document.getElementById('doubleByproduct');
    const simulateBtn = document.getElementById('simulatePurchaseBtn');
    const alertDiv = document.getElementById('alertMessages');

    // Helper to format currency
    const formatZAR = (num) => 'R ' + num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

    // Calculate totals from customers + admin
    function computeRewardsImpact() {
      let claimed = customers.filter(c => c.status === 'claimed').length;
      let active = customers.filter(c => c.status === 'active').length;
      let upcoming = customers.filter(c => c.status === 'upcoming').length;
      let byproductUptake = customers.filter(c => c.byproduct === true).length;
      let referralSum = customers.reduce((acc, c) => acc + (c.referralCredit || 0), 0);
      // discount projection: for active rewards, apply discount % to next purchase (mock avg order R 500)
      let activeDiscountSum = 0;
      if (rewardsEnabled) {
        activeDiscountSum = customers.filter(c => c.status === 'active').reduce((acc, c) => {
          return acc + (discountPercent / 100) * 500; // assume R500 next purchase
        }, 0);
      }
      // byproduct bonus: if doubleByproduct enabled, each byproduct gives extra R30
      let byproductBonus = (doubleByproduct && rewardsEnabled) ? (customers.filter(c => c.byproduct).length * 30) : 0;
      // base net profit from original dashboard (mock)
      let baseNet = 86400; // from earlier
      let adjusted = baseNet - activeDiscountSum + referralSum + byproductBonus;

      // update DOM
      rewardsClaimedSpan.innerText = claimed;
      rewardsActiveSpan.innerText = active;
      rewardsUpcomingSpan.innerText = upcoming;
      byproductUptakeSpan.innerText = byproductUptake;
      referralCreditsSpan.innerText = formatZAR(referralSum);
      projectedDiscountSpan.innerText = formatZAR(activeDiscountSum);
      baseNetProfitSpan.innerText = formatZAR(baseNet);
      totalDiscountsSpan.innerText = '- ' + formatZAR(activeDiscountSum);
      totalReferralsSpan.innerText = '+ ' + formatZAR(referralSum);
      totalByproductBonusSpan.innerText = '+ ' + formatZAR(byproductBonus);
      adjustedNetProfitSpan.innerText = formatZAR(adjusted);

      return { activeDiscountSum, referralSum, byproductBonus, adjusted };
    }

    // Render swipe cards & table
    function renderRewards() {
      // swipe cards (only active/upcoming)
      const swipeHtml = customers.filter(c => c.status !== 'claimed').map(c => `
        <div class="reward-swipe-card">
          <h4>${c.name} (${c.id})</h4>
          <p>${c.type} ¬∑ ${c.progress}/${c.total}</p>
          <div style="display:flex; justify-content:space-between; margin:8px 0;">
            <span class="badge">${c.status}</span><span>exp ${c.expiry}</span>
          </div>
          <div>discount: ${c.discount}%</div>
          <div>by‚Äëproduct: ${c.byproduct ? '‚úÖ' : '‚ùå'}</div>
          <div>referral: R${c.referralCredit}</div>
        </div>
      `).join('');
      swipeContainer.innerHTML = swipeHtml || '<div class="reward-swipe-card">no active rewards</div>';

      // table rows
      const tableRows = customers.map(c => `
        <tr>
          <td>${c.id}</td><td>${c.name}</td><td>${c.type}</td>
          <td>${c.progress}/${c.total}</td><td>${c.status}</td>
          <td>${c.expiry}</td><td>${c.discount}%</td>
          <td>${c.byproduct ? 'Y' : 'N'}</td><td>R${c.referralCredit}</td>
        </tr>
      `).join('');
      tableBody.innerHTML = tableRows;

      // alerts
      const expiring = customers.filter(c => c.expiry < '2025-04-01' && c.status !== 'claimed').length;
      const topAchiever = customers.reduce((best, c) => (c.progress > (best?.progress || 0) ? c : best), null);
      alertDiv.innerText = `‚ú® ${expiring} rewards expiring soon ¬∑ top achiever: ${topAchiever?.name || 'none'} (${topAchiever?.progress || 0} birds)`;

      computeRewardsImpact();
    }

    // Admin control listeners
    function syncRules() {
      rewardsEnabled = rewardsEnabledCheck.checked;
      chickensPerReward = parseInt(chickensPerRewardInput.value) || 10;
      discountPercent = parseFloat(discountPercentInput.value) || 8;
      doubleByproduct = doubleByproductCheck.checked;
      // optionally update customer discount fields based on rule? for demo we keep static
      renderRewards();
    }

    rewardsEnabledCheck.addEventListener('change', syncRules);
    chickensPerRewardInput.addEventListener('input', syncRules);
    discountPercentInput.addEventListener('input', syncRules);
    doubleByproductCheck.addEventListener('change', syncRules);
    document.getElementById('syncRulesBtn').addEventListener('click', syncRules);

    // Simulate purchase: increment progress for a random active customer, maybe claim
    simulateBtn.addEventListener('click', () => {
      const activeCustomers = customers.filter(c => c.status === 'active' || c.status === 'upcoming');
      if (activeCustomers.length === 0) {
        document.getElementById('lastSyncMsg').innerText = 'no active customers to update';
        return;
      }
      const rand = Math.floor(Math.random() * activeCustomers.length);
      const cust = activeCustomers[rand];
      cust.progress = Math.min(cust.total, cust.progress + 1);
      if (cust.progress >= cust.total && cust.status !== 'claimed') {
        cust.status = 'claimed';
        // add referral credit if type referral
        if (cust.type === 'referral') cust.referralCredit += 50;
      } else if (cust.progress >= cust.total * 0.8 && cust.status === 'upcoming') {
        cust.status = 'active';
      }
      // also maybe toggle byproduct
      if (doubleByproduct && Math.random() > 0.7) cust.byproduct = !cust.byproduct;

      renderRewards();
      document.getElementById('lastSyncMsg').innerText = 'last sync: ' + new Date().toLocaleTimeString();
    });

    // initial render
    renderRewards();

    // also attach to existing cost inputs if we want full integration (shortened)
    // but base profit is fixed mock; we could add listeners to original cost inputs? not needed for demo

    console.log('Rewards admin fully integrated.');
  })();
</script>
<!-- backend note: all reward data lives in memory; real sync would use Supabase -->
</body>
</html>